---
title: "Security in Software Applications Proj 2"
author: ["Alex Parri - 2140961 - Master's Degree in Cybersecurity"]
date: "A.Y. 2024/25"
titlepage: true
titlepage-logo: "empty.pdf"
titlepage-background: "bg_2.pdf"
titlepage-color: "FFFFFF"
titlepage-text-color: "000000"
titlepage-rule-color: "000000"
titlepage-rule-height: 0
lang: "eng"
listings: true
listings-disable-line-numbers: true
book: true
classoption: oneside
---

## Abstract

This is the report for the **second project** of the Security in Software Applications course directed by Daniele Friolo for the Academic Year 24/25 for the Master's Degree in **Cybersecurity** at Sapienza University of Rome. In this homework, the goal was to experiment with **fuzz testing**, a form of software dynamic analysis.

Specifically, it was asked to use the [AFL](http://lcamtuf.coredump.cx/afl) tool to **test** the image manipulation software [ImageMagick](https://imagemagick.org/index.php), and summarize the obtained results. It was decided to use one of its forks [AFL++](https://github.com/AFLplusplus/AFLplusplus) as it a **superior, modern and maintained** fork of the former.

The **hardware** utilized for testing is Ryzen 5800X 8-Core 16-Thread @ 4.850GHz with clang v18.1.3, AFL++ v4.32c in Ubuntu 24.04.02 LTS x86_64 and 16GB of RAM.

## AFL++
AFL++ (American Fuzzy Lop ++) is a modern, improved fork of the original AFL (American Fuzzy Lop) binary. It is a **powerful fuzz tester** for finding bugs and vulnerabilities automatically, which involves the input in a target program of **carefully mutated** inputs to more likely trigger unexpected behavior such as crashes and hangs.

## Setting up the tool
Setting up AFL++ is quite a demanding task. 

```bash 
# compiling binary for AFL++
export CC=afl-clang-lto
export CXX=afl-clang-lto++
export AFL_USE_ASAN=1 

./configure --disable-shared --enable-static \
    --without-magick-plus-plus --without-perl \
    --without-x --without-opencl
make -j2
```

```bash
mkdir png-in png-out
cd png-in 
for i in {1..5}; do
    SIZE=$((RANDOM % 40 + 10))
    convert -size ${SIZE}x${SIZE} plasma:fractal noise_$i.png
done 
```

```bash
# running master fuzzer on first CPU core
taskset -c 0 afl-fuzz -M masterfuzzer \
    -i afl-tests/png-in \
    -o afl-tests/png-out/identify \
    -- ImageMagick-6.9.12-98/utilities/identify @@ 
```

```bash
# running $i-th slave fuzzer on CPU core $i 
taskset -c $i afl-fuzz -M slavefuzzer$i \
    -i afl-tests/png-in \
    -o afl-tests/png-out/identify \
    -- ImageMagick-6.9.12-98/utilities/identify @@ 
```

## Fuzzing ImageMagick 
The purpose of this homework was to play around with ImageMagick. It was decided to test with [v6.9.12-98](https://imagemagick.org/archive/releases/) as it was the one present in the student's Ubuntu machine **by default**.